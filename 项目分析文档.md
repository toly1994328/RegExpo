# RegExpo 项目分析文档

## 项目概述

**RegExpo** 是一个跨平台的正则表达式测试工具，基于 Flutter 框架开发，支持多平台部署（Android、iOS、Windows、macOS、Linux、Web、HarmonyOS）。

### 核心功能
- 正则表达式实时匹配与高亮显示
- 文本文件导入与处理
- 正则表达式记录管理
- 关联正则表达式存储
- 暗黑/亮色主题切换
- 系统托盘支持（桌面端）

## 技术架构

### 架构模式
- **状态管理**: BLoC (Business Logic Component) 模式
- **数据持久化**: SQLite 数据库
- **UI 架构**: 响应式设计，支持桌面端和移动端适配

### 核心依赖
```yaml
# 状态管理
flutter_bloc: ^8.1.1
equatable: ^2.0.5

# 数据存储
sqflite: ^2.2.0+3
shared_preferences: ^2.0.15
path_provider: ^2.0.11

# 文件操作
file_picker: ^10.1.8
file_picker_ohos: ^1.0.1

# 桌面端支持
window_manager: ^0.3.0
system_tray: ^2.0.2

# UI 组件
flutter_slidable: ^4.0.0
oktoast: ^3.4.0
```

## 项目结构分析

### 目录结构
```
lib/src/
├── app/           # 应用配置和样式
├── blocs/         # 状态管理层
├── components/    # 可复用组件
├── models/        # 数据模型
├── repositories/  # 数据访问层
├── utils/         # 工具类
└── views/         # 视图层
    ├── adapter/   # 平台适配
    ├── desk_ui/   # 桌面端UI
    └── phone_ui/  # 移动端UI
```

### 核心模块

#### 1. 状态管理 (BLoCs)
- **AppConfigBloc**: 应用配置管理（主题切换等）
- **MatchBloc**: 正则匹配逻辑处理
- **RecordBloc**: 文本记录管理
- **LinkRegexBloc**: 关联正则表达式管理

#### 2. 数据模型 (Models)
- **Record**: 文本记录实体
- **MatchInfo**: 匹配结果信息
- **LinkRegex**: 关联正则表达式实体
- **AppConfig**: 应用配置信息

#### 3. 数据访问层 (Repositories)
- **RecodeRepository**: 记录数据访问接口
- **LinkRegexRepository**: 关联正则数据访问接口
- **RegexParser**: 正则表达式解析器

#### 4. 视图层架构
- **桌面端 (desk_ui)**: 适配大屏幕的布局
- **移动端 (phone_ui)**: 适配小屏幕的布局
- **平台适配器**: 处理不同平台的特殊需求

## 功能模块分析

### 1. 正则匹配模块
- **实时匹配**: 用户输入正则表达式时实时显示匹配结果
- **高亮显示**: 在文本中高亮显示匹配的内容
- **匹配详情**: 显示匹配的详细信息（位置、分组等）

### 2. 文件管理模块
- **文件导入**: 支持多种文本文件格式
- **文件类型检查**: 限制支持的文件扩展名
- **错误提示**: 不支持的文件类型显示 Toast 提示

### 3. 数据管理模块
- **记录管理**: 文本内容的增删改查
- **正则关联**: 将正则表达式与记录关联
- **数据持久化**: 使用 SQLite 存储数据

### 4. 主题系统
- **双主题支持**: 亮色和暗色主题
- **动态切换**: 运行时切换主题
- **系统适配**: 跟随系统主题设置

## 平台支持分析

### 支持平台
- **移动端**: Android, iOS
- **桌面端**: Windows, macOS, Linux
- **Web端**: 浏览器支持
- **HarmonyOS**: 华为鸿蒙系统

### 平台特性
- **系统托盘**: Windows/macOS 支持系统托盘功能
- **窗口管理**: 桌面端支持窗口大小调整
- **文件选择**: 各平台适配的文件选择器

## 数据库设计

### 表结构
```sql
-- 记录表
CREATE TABLE `recoder` (
  `id` INTEGER PRIMARY KEY AUTOINCREMENT,
  `title` VARCHAR(256),
  `content` TEXT
)

-- 关联正则表（推测）
CREATE TABLE `link_regex` (
  `id` INTEGER PRIMARY KEY AUTOINCREMENT,
  `regex` TEXT,
  `record_id` INTEGER,
  FOREIGN KEY (record_id) REFERENCES recoder(id)
)
```

## 代码质量分析

### 优点
1. **架构清晰**: 采用 BLoC 模式，职责分离明确
2. **跨平台支持**: 一套代码支持多个平台
3. **响应式设计**: 适配不同屏幕尺寸
4. **状态管理**: 使用成熟的状态管理方案
5. **数据持久化**: 完整的数据存储方案

### 改进建议
1. **错误处理**: 加强异常处理和用户提示
2. **性能优化**: 大文件处理时的性能优化
3. **测试覆盖**: 增加单元测试和集成测试
4. **文档完善**: 添加代码注释和API文档

## 技术特色

### 1. 多平台适配
- 统一的业务逻辑层
- 平台特定的UI适配
- 原生功能集成（系统托盘、文件选择等）

### 2. 实时正则匹配
- 高效的正则表达式解析
- 实时的文本高亮显示
- 详细的匹配信息展示

### 3. 数据管理
- 完整的CRUD操作
- 关联数据管理
- 本地数据持久化

## 部署和构建

### 构建配置
- **Flutter SDK**: >=2.17.1 <3.0.0
- **多平台构建**: 支持所有 Flutter 目标平台
- **依赖管理**: 使用 pubspec.yaml 管理依赖

### 资源文件
- **图标字体**: 自定义图标字体 TolyIcon
- **示例文件**: 内置多个示例文本文件
- **主题资源**: 完整的主题配置文件

## 总结

RegExpo 是一个设计良好的跨平台正则表达式工具，具有清晰的架构设计和完整的功能实现。项目采用现代化的 Flutter 开发模式，支持多平台部署，具有良好的用户体验和扩展性。通过 BLoC 状态管理模式确保了代码的可维护性，通过 SQLite 数据库提供了可靠的数据持久化方案。